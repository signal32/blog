<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hamish Weir: Blog | Custom vector maps with OpenMapTiles and TileServer-GL</title>
    
    <link rel="stylesheet" href="https://www.hamishweir.uk/styles/style.css?h=92e4a7e4d2d00947b989937462098ca3f3750aaa6f8eea2e87c7201e32a6a481">
    
</head>

<body class="dark:bg-gray-700 bg-slate-300 bg-repeat flex flex-col h-screen" style="background-image: url(/images/circuit-board.svg)">

    <header class="bg-slate-800 mb-5 top-0 sticky shadow-lg" >
        <div class="max-w-2xl mx-auto px-2 sm:px-6">
            <div class="flex justify-between items-center py-1 md:justify-start">
                <img class=" w-2/6 dark:invert py-0" src="https://www.hamishweir.uk/images/logo.svg" alt="Hamish Weir: Blog"/>

                
                <div class=" w-4/6 flex justify-end items-end py-0">
                    
                    
                    
                    
                    <a class="p-1 mx-1 rounded hover:bg-slate-700 text-slate-300 "
                        href=&#x2F;>
                        Home
                    </a>
                    
                    <a class="p-1 mx-1 rounded hover:bg-slate-700 text-slate-300 "
                        href=&#x2F;showcase&#x2F;>
                        Showcase
                    </a>
                    
                    <a class="p-1 mx-1 rounded hover:bg-slate-700 text-slate-300 "
                        href=&#x2F;contact&#x2F;>
                        Contact
                    </a>
                    

                    
                    <svg class=" hover:fill-white fill-slate-400 w-8 h-8 px-2 transition-all">
                        <use xlink:href="/icons/bootstrap-icons.svg#github"/>
                    </svg>
                    
                    <svg class=" hover:fill-white fill-slate-400 w-8 h-8 px-2 transition-all">
                        <use xlink:href="/icons/bootstrap-icons.svg#instagram"/>
                    </svg>
                    

                </div>
                
            </div>
        </div>
    </header>


    <!-- Main content container -->
    <main class="p-2 max-w-2xl mx-auto flex-grow">

        <!-- Notifications/global messages -->
        <div class="rounded-xl p-2 mb-5 bg-slate-800 border border-slate-500 flex justify-between items-center">
            <div class="w-1/5 items-center justify-center flex">
                <svg class="fill-slate-400 h-20 px-1">
                    <use xlink:href="/images/hello.svg#Capa_1"/>
                </svg>
            </div>
            <div class="w-4/5 border-l border-slate-400 pl-4 ">
                <div class="text-lg text-slate-300">Hello, world!</div>
                <div class="text-slate-400">
                    Thanks for visiting. I'm in the process of setting this site up so expect that some features won't work correctly at the moment.
                </div>
            </div>
        </div>



        
<main>

    <div class="mb-4 max-w-2xl mx-auto bg-slate-700 rounded-xl shadow-lg border-2 border-slate-700 hover:border-slate-600 transition-all">
                
        
        <img class="object-cover w-full max-h-64 overflow-auto"src="&#x2F;images&#x2F;posts&#x2F;map_screenshot.png"/>
        
    </div>

    <div class="mb-4 max-w-2xl p-3 mx-auto bg-slate-700 rounded-xl shadow-lg border-2 border-slate-700">
        
        <h1 class=" text-slate-100 text-2xl">Custom vector maps with OpenMapTiles and TileServer-GL</h1>

        
        <p class="text-slate-300 text-lg">1 February, 2022</p>
        

        <div class="text-slate-200 hame-markdown">
            <p>In this post we're going to setup and display our own vector maps with custom styling using free, open source software. 
This solution is ideal for experimentation and prototyping but may not scale well in production.
For simplicity we won't integrate this into any framework, but the fundamentals here will be applicable to most frameworks.</p>
<p>As always, the full code is available on <a href="https://github.com/signal32">GitHub</a>.</p>
<h2 id="building-tiles">Building Tiles</h2>
<p>First we need to source our data and process it into tiles that can be served efficiently.
<a href="https://openmaptiles.org/">OpenMapTiles</a> provides both an open source schema for these tiles and tools to build them from OSM data. I ran into difficulties running it on Windows, however on Ubuntu the process was quite straightforward.</p>
<p>Start by cloning OpenMapTiles:</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">$</span><span> git clone https://github.com/openmaptiles/openmaptiles.git
</span></code></pre>
<p>Open <code>.env</code> and look for the zoom parameters below. For this demo I will increase the <code>MAX_ZOOM</code> to 14, so more detail can be seen when styling the maps later. This will generate files of exponentially larger size so you may wish to use the default setting first before applying this step.</p>
<pre data-lang="py" style="background-color:#2b303b;color:#c0c5ce;" class="language-py "><code class="language-py" data-lang="py"><span style="color:#65737e;"># Which zooms to generate with make generate-tiles-pg
</span><span style="color:#bf616a;">MIN_ZOOM</span><span>=</span><span style="color:#d08770;">0
</span><span style="color:#bf616a;">MAX_ZOOM</span><span>=</span><span style="color:#d08770;">14
</span></code></pre>
<p>Now we can use the convenient <code>quickstart</code> utility to download and build our tiles to <code>data/tiles.mbtiles</code>.</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">$</span><span> ./quickstart.sh scotland
</span></code></pre>
<p>This will take some time, especially if your zoom level is hight, so be patient and go grab a coffee. ☕</p>
<h2 id="serving-tiles">Serving Tiles</h2>
<p>Next, we're going to serve these tiles to our web clients using <a href="https://github.com/maptiler/tileserver-gl">TileServer-GL</a> from 
<a href="https://www.mapbox.com/">MapBox</a> who produce many mapping tool that are arguably easier to setup, however these are generally closed source, cloud based or require a license to use.</p>
<p>We're going to be using Docker to simplify the next few stages so go ahead and create a <code>docker-compose.yml</code> file in your project source directory.</p>
<pre data-lang="yaml" style="background-color:#2b303b;color:#c0c5ce;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#65737e;"># docker-compose.yml
</span><span style="color:#bf616a;">version</span><span>: &#39;</span><span style="color:#a3be8c;">3</span><span>&#39;
</span><span style="color:#bf616a;">services</span><span>:
</span><span>  </span><span style="color:#bf616a;">tileServer</span><span>:
</span><span>    </span><span style="color:#bf616a;">image</span><span>: </span><span style="color:#a3be8c;">maptiler/tileserver-gl:${TILESERVER_VERSION:-latest}
</span><span>    </span><span style="color:#bf616a;">restart</span><span>: </span><span style="color:#a3be8c;">on-failure
</span><span>    </span><span style="color:#bf616a;">command</span><span>: 
</span><span>        </span><span style="color:#a3be8c;">--verbose 
</span><span>        </span><span style="color:#a3be8c;">--config /config/tileserver/tileserver.json 
</span><span>        </span><span style="color:#a3be8c;">--mbtiles /tile_data/tiles/tiles.mbtiles 
</span><span>        </span><span style="color:#a3be8c;">--port 8090
</span><span>    </span><span style="color:#bf616a;">volumes</span><span>:
</span><span>      - </span><span style="color:#a3be8c;">./config:/config
</span><span>      - </span><span style="color:#a3be8c;">${TILESERVER_TILE_DIR:-./data/tileserver}:/tile_data
</span><span>    </span><span style="color:#bf616a;">ports</span><span>:
</span><span>      - &quot;</span><span style="color:#a3be8c;">${TILESERVER_PORT:-8080}:8080</span><span>&quot;
</span></code></pre>
<p>I like to keep configuration variables in an adjacent <code>.env</code> file like so.</p>
<pre data-lang="py" style="background-color:#2b303b;color:#c0c5ce;" class="language-py "><code class="language-py" data-lang="py"><span style="color:#65737e;"># .env
</span><span style="color:#bf616a;">TILESERVER_VERSION</span><span>=latest
</span><span style="color:#bf616a;">TILESERVER_TILE_DIR</span><span>=./tiles
</span><span style="color:#bf616a;">TILESERVER_PORT</span><span>=</span><span style="color:#d08770;">8080
</span></code></pre>
<h2 id="displaying-tiles">Displaying Tiles</h2>
<p>For this we'll use <a href="https://github.com/maplibre/maplibre-gl-js">MapLibre-GL-JS</a> an open source fork of Mapbox GL JS.
Rather than fuss about setting up a web framework we'll keep things concise by linking it into a plain old html file from a CDN.</p>
<pre data-lang="html" style="background-color:#2b303b;color:#c0c5ce;" class="language-html "><code class="language-html" data-lang="html"><span>   &lt;</span><span style="color:#bf616a;">script </span><span style="color:#d08770;">src</span><span>=&quot;</span><span style="color:#a3be8c;">https://unpkg.com/maplibre-gl@1.15.2/dist/maplibre-gl.js</span><span>&quot;&gt;&lt;/</span><span style="color:#bf616a;">script</span><span>&gt;
</span><span>   &lt;</span><span style="color:#bf616a;">link </span><span style="color:#d08770;">href</span><span>=&quot;</span><span style="color:#a3be8c;">https://unpkg.com/maplibre-gl@1.15.2/dist/maplibre-gl.css</span><span>&quot; </span><span style="color:#d08770;">rel</span><span>=&quot;</span><span style="color:#a3be8c;">stylesheet</span><span>&quot;/&gt;
</span></code></pre>
<p><strong>Note:</strong> I'm working on finishing this post soon while using it as an example to assist styling the website in general.</p>
<h2 id="creating-a-custom-theme">Creating a Custom Theme</h2>
<h2 id="conclusion">Conclusion</h2>
<p>I used this approach to display maps in <a href="https://explore.hamishweir.uk/">Exlorer</a> (working title).</p>

        </div>

    </div>
</main>


    </main>


    <footer class=" bg-slate-800 align-bottom">
        <div class="py-2 px-5 max-w-2xl mx-auto flex justify-between items-center md:justify-start">
            <div class="w-1/5">
                <img class="dark:invert py-0" src="https://www.hamishweir.uk/images/logo.svg" alt="Hamish Weir: Blog"/>
            </div>
            <div class="w-4/5">
                <p class="text-slate-400 text-xs text-right">Made with ❤ in Scotland</p>
                <p class="text-slate-400 text-xs text-right">using <a href="https://tailwindcss.com/">Tailwind CSS</a>  and <a href="https://www.getzola.org/">Zola</a></p>
            </div>
        </div>
    </footer>

</body>